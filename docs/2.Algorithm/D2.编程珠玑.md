---
id : C2.编程珠玑
title : C2.编程珠玑
typora-root-url : ../
---

# 编程珠玑

[TOC]

## 开篇

> 1 2 3 4 5 6 7 8 
>
> A：我该如何对磁盘文件进行排序？ 
>
> B：需要排序的内容是什么？文件中有多少条记录？每个记录的格式是什么？ 
>
> A：该文件包含至多10,000,000个记录，每条记录都是一个7位整数。 
>
> B：如果文件那么小，为什么要使用磁盘排序呢？为什么不在主存中对它排序？
>
>  A：该功能是某大型系统中的一部分，大概只能提供1MB主存给它。 
>
> B：你能将记录方面的内容说得更详细一些吗？ A：每个记录是一个7位正整数，没有其它的关联数据，每个整数至多只能出现一次。 ... ... 

如果主存容量不是严苛地限制在1MB

可一次性将所有数据都加载到主存中，用Bitmap来做。

10,000,000个数就需要10,000,000位，也就是10,000,000b = 1.25MB。Bitmap需要1.25MB

1. 第一步，初始化所有的位为0；
2. 第二步，读取文件中每个整数， 如果该整数对应的位已经为1，说明前面已经出现过这个整数，抛出异常，退出程序 (输入要求每个整数都只能出现一次)。否则，将相应的位置1；
3.  第三步，检查每个位，如果某个位是1，就写出相应的整数，从而创建已排序的输出文件。

如果主存容量严苛地限制在1MB

该文件分割成两个文件， 再分别用Bitmap处理。

分割策略可以简单地把前一半的数据放到一个文件， 后一半的数据放到另一个文件，分别排序后再做归并。

 也可以把文件中小于某个数(比如5,000,000)的整数放到一个文件，叫less.txt， 把其余的整数放到另一个文件，叫greater.txt。分别排序后， 把greater.txt的排序结果追加到less.txt的排序结果即可。



> 给定一个包含32位整数的顺序文件，它至多只能包含40亿个这样的整数， 并且整数的次序是随机的。请查找一个此文件中不存在的32位整数。 在有足够主存的情况下，你会如何解决这个问题？ 如果你可以使用若干外部临时文件，但可用主存却只有上百字节， 你会如何解决这个问题？





> 请将一个具有n个元素的一维向量向左旋转i个位置。例如，假设n=8,i=3， 那么向量abcdefgh旋转之后得到向量defghabc。



3次翻转即可，无需额外空间：

```cpp
reverse(0, i-1); // cbadefgh 
reverse(i, n-1); // cbahgfed 
reverse(0, n-1); // defghabc 
```



> 给定一本英语单词词典，请找出所有的变位词集。例如，因为“pots”， “stop”，“tops”相互之间都是由另一个词的各个字母改变序列而构成的， 因此这些词相互之间就是变位词。

1. 第一步，将每个单词按字典序排序， 做为原单词的签名，这样一来，变位词就会具有相同的签名。 
2. 第二步，对所有的单词按照其签名进行排序，这样一来，变位词就会聚集到一起。 
3. 第三步，将变位词分组，形成变位词集。示意图如下：

![img](/Image/C2.编程珠玑-photo/anagrams.png)

## 数据决定程序结构

数据的表示形式是程序设计的根本

- 使用数组重新编写重复代码。冗长的相似代码常常可以使用最简单的数据结构—— 数组来更好地表述。
- 封装复杂结构。当需要非常复杂的数据结构时，使用抽象术语进行定义， 并将操作表示为类。
- 尽可能使用高级工具。超文本，名字-值对，电子表格，数据库， 编程语言等都是特定问题领域中的强大的工具。
- 从数据得出程序的结构。在动手编写代码之前，优秀的程序员会彻底理解输入， 输出和中间数据结构，并围绕这些结构创建程序。

提到的书籍：

Polya的《How to Solve it》，

中文书《怎样解题》； 

Kernighan和Plauger的《Elements of Programming Style》；

Fred Brooks的《人月神话》 

Steve McConnell的《代码大全》；

《Rapid Development》； 《

Software Project Survival Guide》

## 编写正确的程序

深入阅读：David Gries的《Science of Programming》 是程序验证领域里极佳的一本入门书籍。

## 编程中的次要问题

- 使用断言assert
- 自动化测试程序

进阶阅读：《Practice of Programming》第5章(调试)，第6章(测试) 《Code Complete》第25章(单元测试)，第26章(调试)

## 程序性能分析

从设计层面提升程序性能：

1. 问题定义。良好的问题定义可以有效减少程序运行时间和程序长度。
2. 系统结构。将大型系统分解成模块，也许是决定其性能的最重要的单个因素。
3. 算法和数据结构。这个不用说了。
4. 代码调优。针对代码本身的改进。
5. 系统软件。有时候改变系统所基于的软件比改变系统本身更容易。
6. 硬件。更快的硬件可以提高系统的性能。

深入阅读：Butler Lampson的“Hints for Computer System Design”， 该论文特别适合于集成硬件和软件的计算机系统设计。