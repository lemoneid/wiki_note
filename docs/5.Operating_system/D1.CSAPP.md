---
id : D1.CSAPP
title : D1.CSAPP
typora-root-url : ../
---

[TOC]

> ORG:更多地强调了对程序员的影响。例如 ,要反过来考虑数据表示对C语言程序的数据类型 和操作的影响
> ORG+:强调硬件对应用程序性能,代码优化和改进C语言程序的内存性能
> ICS+:系统级网络编程和并发编程

## 计算机系统漫游

### 信息就是位 +上下文

大部分的现代计算机系统都使用ASCII标准来表示文本字符,这种方式实际上就是用一个唯一的单字节大小的整数值来表示每个字符

只由 ASCII 字 符构成的文件称为**文本文件** , 所有其他文件都称为**二进制文件**

系统中所有的信息包括磁盘文件、内存中的程序、内存中存放的用户数据以及网络上传送的数据,都是由一串比特表示的。区分不同数据对象的唯一方法是我们读到这些数据对象时的上下文。比如,在不同的上下文中,一个同样的字节序列可能表示一个整数、浮点数、字符串或者机器指令。

- 汇编阶段:接下来,汇编器(as)将hello.s翻译成机器语言指令,把这些指令打包成一种叫做可重定位目标程序格式,并将结果保存在目标文件hello.o,一个二进制文件,它包含的17个字节是函数main的指令编码。如果我们在文本编辑器中打开hello.文件,将看到一堆乱码
- 链接阶段:printf函数存在于一个名为printf.o的单独的预编译好了的目标文件中,而这个文件必须以某种方式合并到我们的hello.
  .o程序中。链接器(Id)就负责处理这种合并。结果就得到hello文件,它是一个可执行目标文件可以被加载到内存中,由系统执行。

缓冲区溢出错误是造成大多数网络和Internet服务器上安全漏洞的主要原因。

存在这些错误是因为很少有程序员能够理解需要限制从不受信任的源接收数据的数量和格式。
学习安全编程的第一步就是理解数据和控制信息存储在程序栈上的方式会引起的后果

系统的硬件组成

1. 总线
   贯穿整个系统的是一组电子管道,称作总线,它携带信息字节并负责在各个部件间传递。通常总线被设计成传送定长的字节块,也就是字(word)。字中的字节数(即字长)是一个基本的系统参数,各个系统中都不尽相同。现在的大多数机器字长要么是4个字节(32位),要么是8个字节(64位)。
2. I/O设备
   I/O(输入/输出)设备是系统与外部世界的联系通道。我们的示例系统包括四个I/O设备:作为用户输入的键盘和鼠标,作为用户输出的显示器,以及用于长期存储数据和程序的磁盘驱动器(简单地说就是磁盘)。最开始,可执行程序hello就存放在磁盘上。每个I/O设备都通过一个控制器或适配器与I/O总线相连。控制器和适配器之间的区别主要在于它们的封装方式。控制器是I/O设备本身或者系统的主印制电路板(通常称作主板)上的芯片组。而适配器则是一块插在主板插槽上的卡。无论如何,它们的功能都是在I/O总线和I/O设备之间传递信息。
3. 主存
   主存是一个临时存储设备,在处理器执行程序时,用来存放程序和程序处理的数据。从物理上来说,主存是由一组动态随机存取存储器(DRAM)芯片组成的。从逻辑上来说,存储器是一个线性的字节数组,每个字节都有其唯一的地址(数组索引),这些地址是从零开始的。一般来说,组成程序的每条机器指令都由不同数量的字节构成。与C程序变量相对应的数据项的大小是根据类型变化的。
4. 中央处理单元(CPU),简称处理器
   是解释(或执行)存储在主存中指令的引擎。处理器的核心是一个大小为一个字的存储设备(或寄存器),称为程序计数器(PC)。在任何时刻,PC都指向主存中的某条机器语言指令(即含有该条指令的地址)。从系统通电开始,直到系统断电,处理器一直在不断地执行程序计数器指向的指令,再更新程序计数器,使其指向下一条指令。处理器看上去是按照一个非常简单的指令执行
   模型来操作的,这个模型是由指令集架构决定的。在这个模型中,指令按照严格的顺序执行,而执行一条指令包含执行一系列的步骤。处理器从程序计数器指向的内存处读取指令,解释指令中的位,执行该指令指示的简单操作,然后更新PCÿ使其指向下一条指令,而这条指令并不一定和在内存中刚刚执行的指令相邻。
   这样的简单操作并不多,它们围绕着主存、寄存器文件(register file)和算术/逻辑单元(ALU)进行。寄存器文件是一个小的存储设备,由一些单个字长的寄存器组成,每个寄存器都有唯一的名字。ALU计算新的数据和地址值。![image-20210523114120904](/Image/D1.CSAPP-photo/JY7TXImvzKxW9V8.png)![image-20210524150816468](/Image/D1.CSAPP-photo/image-20210524150816468.png)

### 高速缓存

![image-20210524151153886](/Image/D1.CSAPP-photo/image-20210524151153886.png)所有应用程序对硬件的操作尝试都必须通过操作系统。
操作系统有两个基本功能:

(1)防止硬件被失控的应用程序滥用;

(2)向应用程序提供简单一致的机制来控制复杂而又通常大
不相同的低级硬件设备。

文件是对I/O设备的抽象表示,虚拟内存是对主存和磁盘I/O设备的抽象表示,进程则是对处理
器、主存和I/O设备的抽象表示。

### 硬件

#### 进程

进程是操作系统对一个正在运行的程序的一种抽象。在一个系统上可以同时运行多个进程,而每个进程都好像在独占地使用硬件。而并发运行,则是说一个进程的指令和另一个进程的指令是交错执行的

#### 线程

一 个进程实际上可以由多个称为线程的执行单元组成(提供多个控制流)

#### 虚拟内存

它为每个进程提供了一个假象,即每个进程都在独占地使用主存。

每个进程看到的内存都是一致的,称为虚拟地址空间

基本思想是把一个进程虚拟内存的内容存储在磁盘上,然后用主存作为磁盘的高速缓存

#### 文件

文件就是字节序列,每个I/O设备,包括磁盘、键盘、显示器,甚至网络,都可以看成是文件

系统中的所有输人输出都是通过使用一小组称为UnixI/O的系统函数调用读写文件来实现的。
文件向应用程序提供了一个统一的视图,来看待系统中可能含有的所有各式各样的I/O设备。

#### Amdahl 定律

$$
\begin{aligned}
\alpha : &提升部分占总执行时间的比例\\
k : &提升部分性能提升比例\\
T_{new} &= (1 - \alpha)T_{old} + (\alpha T_{old})/k \\
&= T_{old}[(1 - \alpha) + \alpha / k]\\
加速比S &=\frac{ T_{old}}{T_{new}}\\
&=\frac{1}{(1 - \alpha) + \alpha / k}
\end{aligned}
$$

#### 并发和并行

术语并发 (concurrency) 是一通用的概念,指一个同时具有多个活动的系统;

术语并行(parallelism)指用并发来使一个系统运行得更快 。

并行可以在计算机系统的多个抽象层次上运用

![image-20210524173823428](/Image/D1.CSAPP-photo/image-20210524173823428.png)

1. 线程级并发

2. 指令级并行

3. 单指令、多数据并行

![image-20210524174907583](/Image/D1.CSAPP-photo/image-20210524174907583.png)

#### 小结

​	计算机系统是由硬件和系统软件组成的,它们共同协作以运行应用程序。计算机内部的信息被表示为一组组的位,它们依据上下文有不同的解释方式。程序被其他程序翻译成不同的形式,开始时是ASCII文本,然后被编译器和链接器翻译成二进制可执行文件。
​	处理器读取并解释存放在主存里的二进制指令。因为计算机花费了大量的时间在内存、I/O设备和
CPU寄存器之间复制数据,所以将系统中的存储设备划分成层次结构-CPU寄存器在顶部,接着是多层的硬件高速缓存存储器、DRAM主存和磁盘存储器。在层次模型中,位于更高层的存储设备比低层的
存储设备要更快,单位比特造价也更高。层次结构中较高层次的存储设备可以作为较低层次设备的高速
缓存。通过理解和运用这种存储层次结构的知识,程序员可以优化C程序的性能。
​	操作系统内核是应用程序和硬件之间的媒介。

它提供三个基本的抽象:1)文件是对I/O设备的抽象。
2)虚拟内存是对主存和磁盘的抽象;
3)进程是处理器、主存和
最后,网络提供了计算机系统之间通信的手段。从特殊系统的角度来看,网络就是一种I/O设备。