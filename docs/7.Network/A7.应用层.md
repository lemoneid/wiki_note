---
id : A7.应用层
title : A7.应用层
typora-root-url : ../
---

# 应用层



## 应用层协议网络应用程序的体系结构

- C/S结构
- P2P结构

![img](/Image/A7.应用层-photo/724d99d60c222ef8_img4-1623741071018)

![img](/Image/A7.应用层-photo/724d99d60c222ef8_img5-1623741071018)

### 进程通信

- 所有CS结构的网络应用程序,都是由成对的进程组成
- 在P2P结构中,发起通信为客户端,等待服务的进程为服务器

P2P:两主机为对等方,(百度网盘由中心节点,占用网络,计算机资源),不安全,没有激励机制

### socket套接字:

- 应用程序与网络的APT
- 对运输层仅限于选择传输协议和设定参数

### 进程寻址

​	进程(开发者控制)->套接字(操作系统控制)->TCP<->因特网

### 可供应用程序使用的运输服务

- 可靠数据传输
- 吞吐量
- 定时
- 安全性

TCP:面向连接的服务,可靠的数据传输

UDP:不提供必要服务的轻量级运输服务,不可靠的数据传输



### 应用程序的网络服务要求

| 应用                | 数据丢失 | 带宽                       | 时间敏感  |
| ------------------- | -------- | -------------------------- | --------- |
| 文件传输            | 不能丢失 | 弹性                       | 不        |
| 电子邮件            | 不能丢失 | 弹性                       | 不        |
| Web文档             | 不能丢失 | 弹性（几kbps）             | 不        |
| 因特网电话/视频会议 | 容忍丢失 | 几kbps~1Mbps /10kbps~5Mbps | 是，100ms |
| 存储音频/视频       | 容忍丢失 | 同上                       | 是，几秒  |
| 交互式游戏          | 容忍丢失 | 几kbps ~ 10kbps            | 是，100ms |
| 即时讯息            | 不能丢失 | 弹性                       | 是和不是  |

###  应用程序及其协议，支持的运输层协议

| 应用       | 应用层协议 | 运输层协议 |
| ---------- | ---------- | ---------- |
| 电子邮件   | SMTP       | TCP        |
| 远程终端访 | Telnet     | TCP        |
| Web        | HTTP       | TCP        |
| 文件传输   | FTP        | TCP        |
| 流式多媒体 | HTTP       | TCP        |
| 因特网电话 | SIP、 RTP  | TCP UDP    |

#### 应用层协议定义

- 交换报文类型,如请求报文和响应报文
- 各种报文类型的语法,如报文中各个字段的定义以及这些字段的描述
- 字段的语义,即这些字段中包含的信息的含义
- 一个进程何时以及如何发送报文,对报文进行响应的规则

## DNS域名系统

DNS（Domain Name System，域名系统） 是一个分布式数据库，提供了**主机名和 IP 地址之间相互转换**的服务。这里的分布式数据库是指，每个站点只保留它自己的那部分数据。

域名具有层次结构，从上到下依次为：根域名、顶级域名、二级域名。

 [![img](/Image/A7.应用层-photo/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f62353465656231362d306230652d343834632d626536322d3330366635376334306437372e6a7067)](https://camo.githubusercontent.com/5a570852a0baf09c9592f0a08c8476cf3d653b8d673ca47d8f3e65342d5fd81c/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f62353465656231362d306230652d343834632d626536322d3330366635376334306437372e6a7067) 

域名：

- `域名 ::= {<三级域名>.<二级域名>.<顶级域名>}`，如：`blog.huihut.com`

DNS 可以使用 UDP 或者 TCP 进行传输，使用的端口号都为 53。当前，对于每一级域名长度的限制是 63 个字符，域名总长度则不能超过 253 个字符。大多数情况下 DNS 使用 UDP 进行传输，这就要求域名解析器和域名服务器都必须自己处理超时和重传从而保证可靠性。在两种情况下会使用 TCP 进行传输：

- 如果返回的响应超过的 512 字节（UDP 最大只支持 512 字节的数据）。
- 区域传送（区域传送是主域名服务器向辅助域名服务器传送变化的那部分数据）。



**用于将域名转换为IP地址。**

#### 集中式DNS可能的问题

- 单点故障
- 通信容量大
- 远离集中式数据库的,时延高
- 维护不易

![img](/Image/A7.应用层-photo/724d99d60c222ef8_img47-1623741071018)

1,8递归,2,3,4,5,6,7迭代

TLD顶级域服务器.com;.cn

DNS解析过程有两种，分别是递归查询和迭代查询。

* 递归查询
  * 若主机询问的本地域名服务器不知道被查询域名的IP地址，本地域名服务器以DNS客户身份，向其他根域名服务器继续发出查询请求报文（代替该主机继续查询），而不是该主机自己进行下一步查询 
* 迭代查询
  * 当根域名服务器收到本地域名服务器发出的迭代查询请求报文时，要么给出IP地址，要么告诉本地域名服务器，应该向哪一个域名服务器进行查询，然后本地域名服务器进行后续查询

![img](/Image/A7.应用层-photo/724d99d60c222ef8_img48-1623741071018)







## FTP文件传送协议

FTP （File Transfer Protocol，文件传输协议）使用 TCP 进行连接，它需要两个连接来传送一个文件：

- 控制连接：服务器打开端口号 21 等待客户端的连接，客户端主动建立连接后，使用这个连接将客户端的命令传送给服务器，并传回服务器的应答。
- 数据连接：用来传送一个文件数据。

根据数据连接是否是服务器端主动建立，FTP 有主动和被动两种模式：

- 主动模式：服务器端主动建立数据连接，其中服务器端的端口号为 20，客户端的端口号随机，但是必须大于 1024，因为 0~1023 是熟知端口号。

 [![img](/Image/A7.应用层-photo/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f30336634373934302d333834332d346235312d396534322d3564636166663434383538622e6a7067)](https://camo.githubusercontent.com/5356c8fe1bc1ba9be429d8e7868fa054b536e06c189ee181d030e90d26d02ecf/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f30336634373934302d333834332d346235312d396534322d3564636166663434383538622e6a7067) 



- 被动模式：客户端主动建立数据连接，其中客户端的端口号由客户端自己指定，服务器端的端口号随机。

 [![img](/Image/A7.应用层-photo/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f62653563326336312d383664322d346462612d613238392d6234386561323332313964652e6a7067)](https://camo.githubusercontent.com/9f8b3b9b29d7f93c9d213288b27892f049d013604ace12a216415e8717dc4725/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f62653563326336312d383664322d346462612d613238392d6234386561323332313964652e6a7067) 



主动模式要求客户端开放端口号给服务器端，需要去配置客户端的防火墙。被动模式只需要服务器端开放端口号即可，无需客户端配置防火墙。但是被动模式会导致服务器端的安全性减弱，因为开放了过多的端口号。

TFTP（Trivial File Transfer Protocol，简单文件传输协议）一个小且易实现的文件传输协议，也使用客户-服务器方式，使用UDP数据报，只支持文件传输而不支持交互，没有列目录，不能对用户进行身份鉴定

![img](/Image/A7.应用层-photo/724d99d60c222ef8_img37-1623741071018)

![image-20210614183038392](/Image/A7.应用层-photo/image-20210614183038392-1623741071018.png)

21控制端口是长连接:不进行任何操作,仍不会断开

20数据端口是短连接:可以通过关闭连接表示一个文件传输完毕

FTP使用客户/服务器模式，使用 TCP 数据报，提供交互式访问，双向传输。



#### FTP命令和回答

| 命令          | 解释                                   |
| ------------- | -------------------------------------- |
| USER          | username                               |
| PASS          | passwd                                 |
| LIST          | 请求文件列表,数据连接,新建且非连续连接 |
| RETR filename | get文件                                |
| STRO filename | put文件                                |

典型回答:331 Username OK, Password Required

## DHCP动态主机配置协议

DHCP (Dynamic Host Configuration Protocol) 提供了即插即用的连网方式，用户不再需要手动配置 IP 地址等信息。

动态主机配置协议 MAC地址->IP地址

DHCP 配置的内容不仅是 IP 地址，还包括子网掩码、网关 IP 地址。

DHCP 工作过程如下：

1. 客户端发送 Discover 报文，该报文的目的地址为 255.255.255.255:67，源地址为 0.0.0.0:68，被放入 UDP 中，该报文被广播到同一个子网的所有主机上。如果客户端和 DHCP 服务器不在同一个子网，就需要使用中继代理。
2. DHCP 服务器收到 Discover 报文之后，发送 Offer 报文给客户端，该报文包含了客户端所需要的信息。因为客户端可能收到多个 DHCP 服务器提供的信息，因此客户端需要进行选择。
3. 如果客户端选择了某个 DHCP 服务器提供的信息，那么就发送 Request 报文给该 DHCP 服务器。
4. DHCP 服务器发送 Ack 报文，表示客户端此时可以使用提供给它的信息。

 [![img](/Image/A7.应用层-photo/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f32333231396534632d396663302d343035312d623333612d3262643935626630353461622e6a7067)](https://camo.githubusercontent.com/7c73e5315582ad00ac7d93a58b5a26944b896b7a3107b82e4bbfad61f86da3af/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f32333231396534632d396663302d343035312d623333612d3262643935626630353461622e6a7067) 

![img](/Image/A7.应用层-photo/a2c2efa0b214fcd8_img17-1623741071019)

## TELNET远程登录协议

TELNET 协议是 TCP/IP 协议族中的一员，是 Internet 远程登陆服务的标准协议和主要方式。它为用户提供了在本地计算机上完成远程主机工作的能力。

TELNET 用于登录到远程主机上，并且远程主机上的输出也会返回。

TELNET 可以适应许多计算机和操作系统的差异，例如不同操作系统系统的换行符定义。

## 电子邮件协议

一个电子邮件系统由三部分组成：用户代理、邮件服务器以及邮件协议。

邮件协议包含发送协议和读取协议，发送协议常用 SMTP，读取协议常用 POP3 和 IMAP。

![img](/Image/A7.应用层-photo/724d99d60c222ef8_img42-1623741071018)

 [![img](/Image/A7.应用层-photo/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f37623365666139392d643330362d343938322d386366622d6537313533633333616162342e706e67)](https://camo.githubusercontent.com/8f071866ed78ee7403deed893b30ecb9cbfcb293e558988e48003e315ff06f2b/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f37623365666139392d643330362d343938322d386366622d6537313533633333616162342e706e67) 



### 1. SMTP

SMTP（Simple Mail Transfer Protocol，简单邮件传输协议）是一组用于由源地址到目的地址传送邮件的规则，由它来控制信件的中转方式。SMTP 协议属于 TCP/IP 协议簇，它帮助每台计算机在发送或中转信件时找到下一个目的地。

SMTP只能发送 ASCII 码，而互联网邮件扩充 MIME 可以发送二进制文件。MIME 并没有改动或者取代 SMTP，而是增加邮件主体的结构，定义了非 ASCII 码的编码规则。

 [![img](/Image/A7.应用层-photo/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f65643535323262622d336136302d343831632d383635342d3433653731393561343866652e706e67)](https://camo.githubusercontent.com/338a79fbf44ed147d719afd916c92fb66d0744305959f75fdfeeb020361eeca0/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f65643535323262622d336136302d343831632d383635342d3433653731393561343866652e706e67) 

 

### 2. POP3

POP3 的特点是只要用户从服务器上读取了邮件，就把该邮件删除。但最新版本的 POP3 可以不删除邮件。

### 3. IMAP

IMAP 协议中客户端和服务器上的邮件保持同步，如果不手动删除邮件，那么服务器上的邮件也不会被删除。IMAP 这种做法可以让用户随时随地去访问服务器上的邮件。

## 常用端口

| 应用             | 应用层协议 | 端口号  | 传输层协议 | 备注                        |
| ---------------- | ---------- | ------- | ---------- | --------------------------- |
| 域名解析         | DNS        | 53      | UDP/TCP    | 长度超过 512 字节时使用 TCP |
| 动态主机配置协议 | DHCP       | 67/68   | UDP        |                             |
|                  | TFTP       | 69      |            |                             |
| 简单网络管理协议 | SNMP       | 161/162 | UDP        |                             |
| 文件传送协议     | FTP        | 20/21   | TCP        | 控制连接 21，数据连接 20    |
| 远程终端协议     | TELNET     | 23      | TCP        |                             |
| 超文本传送协议   | HTTP       | 80      | TCP        |                             |
|                  | HTTPS      | 443     |            |                             |
| 简单邮件传送协议 | SMTP       | 25      | TCP        |                             |
| 邮件读取协议     | POP3       | 110     | TCP        |                             |
| 网际报文存取协议 | IMAP       | 143     | TCP        |                             |

## WEB与HTTP协议

#### WEB服务的应用层协议

- HTTP（HyperText Transfer Protocol，超文本传输协议）是一种用于分布式、协作式和超媒体信息系统的应用层协议。HTTP 是万维网的数据通信的基础。\
- 客户程序和服务器程序运行在不同的端系统中(==C/S结构==),通过交换报文进行会话

#### WEB术语

- Web页面(Web page, 文档)

- 对象(对象树)

- HTML基本文件

- URL

  * URL（Uniform Resource Locator，统一资源定位符）是因特网上标准的资源的地址

  - 标准格式：
    - `协议类型:[//服务器地址[:端口号]][/资源层级UNIX文件路径]文件名[?查询][#片段ID]`
  - 完整格式：

    - `协议类型:[//[访问资源需要的凭证信息@]服务器地址[:端口号]][/资源层级UNIX文件路径]文件名[?查询][片段ID]`s

  > 其中【访问凭证信息@；:端口号；?查询；#片段ID】都属于选填项  
  > 如：`https://github.com/huihut/interview#cc`

- Web浏览器



## WWW

- WWW（World Wide Web，环球信息网，万维网）是一个由许多互相链接的超文本组成的系统，通过互联网访问



## HTTP

HTTP（HyperText Transfer Protocol，超文本传输协议）是一种用于分布式、协作式和超媒体信息系统的应用层协议。HTTP 是万维网的数据通信的基础。

![img](/Image/A7.应用层-photo/724d99d60c222ef8_img19-1623741071018)

请求方法

| 方法    | 意义                                                         |
| ------- | ------------------------------------------------------------ |
| OPTIONS | 请求一些选项信息，允许客户端查看服务器的性能                 |
| GET     | 请求指定的页面信息，并返回实体主体                           |
| HEAD    | 类似于 get 请求，只不过返回的响应中没有具体的内容，用于获取报头 |
| POST    | 向指定资源提交数据进行处理请求（例如提交表单或者上传文件）。数据被包含在请求体中。POST请求可能会导致新的资源的建立和/或已有资源的修改 |
| PUT     | 从客户端向服务器传送的数据取代指定的文档的内容               |
| DELETE  | 请求服务器删除指定的页面                                     |
| TRACE   | 回显服务器收到的请求，主要用于测试或诊断                     |

状态码（Status-Code）

- 1xx：表示通知信息，如请求收到了或正在进行处理
  - 100 Continue：继续，客户端应继续其请求
  - 101 Switching Protocols 切换协议。服务器根据客户端的请求切换协议。只能切换到更高级的协议，例如，切换到 HTTP 的新版本协议
- 2xx：表示成功，如接收或知道了
  - 200 OK: 请求成功
- 3xx：表示重定向，如要完成请求还必须采取进一步的行动
  - 301 Moved Permanently: 永久移动。请求的资源已被永久的移动到新 URL，返回信息会包括新的 URL，浏览器会自动定向到新 URL。今后任何新的请求都应使用新的 URL 代替
- 4xx：表示客户的差错，如请求中有错误的语法或不能完成
  - 400 Bad Request: 客户端请求的语法错误，服务器无法理解
  - 401 Unauthorized: 请求要求用户的身份认证
  - 403 Forbidden: 服务器理解请求客户端的请求，但是拒绝执行此请求（权限不够）
  - 404 Not Found: 服务器无法根据客户端的请求找到资源（网页）。通过此代码，网站设计人员可设置 “您所请求的资源无法找到” 的个性页面
  - 408 Request Timeout: 服务器等待客户端发送的请求时间过长，超时
- 5xx：表示服务器的差错，如服务器失效无法完成请求
  - 500 Internal Server Error: 服务器内部错误，无法完成请求
  - 503 Service Unavailable: 由于超载或系统维护，服务器暂时的无法处理客户端的请求。延时的长度可包含在服务器的 Retry-After 头信息中
  - 504 Gateway Timeout: 充当网关或代理的服务器，未及时从远端服务器获取请求

> 更多状态码：[菜鸟教程 . HTTP状态码](http://www.runoob.com/http/http-status-codes.html)

#### HTTP特点

- HTTP不用担心数据丢失,TCP协议

- HTTP是一个无状态协议,服务器不存储关于客户的状态信息

- HTTP服务器总是处于打开状态,具有一个固定IP

- HTTP使用C/S结构

#### 非持续连接(短连接)和持续连接(长连接)

1. HTTP客户端发起一个到服务器的TCP连接,使用默认端口80,服务器上和客户端上都有一个套接字与之对应

2. HTTP客户经socket向服务器发送请求GET报文,报文包好请求对象

3. HTTP服务器接受该报文,从服务器上检索对象,在HTTP响应报文中封装该对象,并通过socket发送

4. HTTP服务器通知TCP断开TCP连接

5. HTTP客户接收响应报文,TCP连接关闭

6. 对于多个对象重复上述

#### 请求报文

![image-20210614183021599](/Image/A7.应用层-photo/image-20210614183021599-1623741071018.png)

#### 请求方法

| 方法    | 意义                                                         |
| ------- | ------------------------------------------------------------ |
| OPTIONS | 请求一些选项信息，允许客户端查看服务器的性能                 |
| GET     | 请求指定的页面信息，并返回实体主体                           |
| HEAD    | 类似于 get 请求，只不过返回的响应中没有具体的内容，用于获取报头 |
| POST    | 向指定资源提交数据进行处理请求（例如提交表单或者上传文件）。数据被包含在请求体中。POST请求可能会导致新的资源的建立和/或已有资源的修改 |
| PUT     | 从客户端向服务器传送的数据取代指定的文档的内容               |
| DELETE  | 请求服务器删除指定的页面                                     |
| TRACE   | 回显服务器收到的请求，主要用于测试或诊断                     |

#### 状态码（Status-Code）

* 1xx：表示通知信息，如请求收到了或正在进行处理
  * 100 Continue：继续，客户端应继续其请求
* 2xx：表示成功，如接收或知道了
  * 200 OK: 请求成功
* 3xx：表示重定向，如要完成请求还必须采取进一步的行动
  * 301 Moved Permanently: 永久移动。请求的资源已被永久的移动到新 URL，返回信息会包括新的 URL，浏览器会自动定向到新 URL。今后任何新的请求都应使用新的 URL 代替
* 4xx：表示客户的差错，如请求中有错误的语法或不能完成
  * 400 Bad Request: 客户端请求的语法错误，服务器无法理解
  * 403 Forbidden: 服务器理解请求客户端的请求，但是拒绝执行此请求（权限不够）
  * 404 Not Found: 服务器无法根据客户端的请求找到资源（网页）。通过此代码，网站设计人员可设置 “您所请求的资源无法找到” 的个性页面
  * 408 Request Timeout: 服务器等待客户端发送的请求时间过长，超时
* 5xx：表示服务器的差错，如服务器失效无法完成请求
  * 500 Internal Server Error: 服务器内部错误，无法完成请求
  * 505 HTTP Version Not Supportted

#### 用户与服务器的交互--COOKIE

- 在HTTP响应报文中的一个cookie首部行
- 在HTTP请求报文中的一个cookie首部行
- 在用户端有浏览器管理的cookie文件
- 位于WEB后端的一个数据库



![image-20210614183029678](/Image/A7.应用层-photo/image-20210614183029678.png)



#### WEB缓存器

![img](/Image/A7.应用层-photo/724d99d60c222ef8_img29-1623741071018)

WEB缓存器优点

- 大大减少客户请求的响应时间(如何缓存器中存在直接返回)



### HTTP协议与HTTPS协议

HTTP->TCP

HTTPS->SSL(加密)/TLS(解密)->TCP

#### HTTPS

- https协议需要申请证书
- http是超文本传输协议,信息是明文传输,https是具有安全性的ssl加密传输协议
- http(80)和https(443端口)是完全不同的连接方式
- http连接简单,无状态
- https协议是SSL+HTTP,可进行加密传输和身份认证的网络协议

#### HTTP2

![img](/Image/A7.应用层-photo/724d99d60c222ef8_img35-1623741071018)
