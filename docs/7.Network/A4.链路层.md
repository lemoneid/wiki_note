---
id : A4.链路层
title : A4.链路层
typora-root-url : ../
---

# 链路层

## 基本概念

#### 数据链路和链路

链路：指的是从一个节点到相邻节点的一段**物理线路**，且中间没有任何其他的交换节点

数据链路：传输数据时，除了一条物理线路，还需要一些必要通信协议来控制这些传输。

#### 三个目的

在 TCP/IP 协议族中，链路层主要有三个目的：

1. 为 IP模块发送和接收 IP数据报；
2. 为 ARP模块发送 ARP请求和接收 ARP应答；
3. 为 RARP 发送 RARP 请求和接收 RARP应答。

TCP/IP支持多种不同的链路层协议，这取决于网络硬件，如以太网、令牌环网、FDDI和RS-232串行线路等。

## 基本问题 

![img](/Image/A4.链路层-photo/437dc2ff98edb42a_img4-1623741071019)

### 1. 封装成帧

网络层协议数据单元就是 **IP数据报**， 数据链路封装成的帧，在物理层变成数字信号在链路上传输。

+ 封装成帧，就是在将**网络层的IP数据报**的前后分别添加**首部**和**尾部**，这样就构成了一个帧。

+ 不同的数据链路层协议的帧的首部和尾部包含的信息有明确的规定，帧的首部和尾部有`帧开始符`和`帧结束符`，称为**帧定界符**。接收端收到物理层传过来的数字信号读取到帧开始字符一直到帧结束字符，就认为接收到了一个完整的帧。在数据传输中出现差错时，帧定界符的作用更加明显。`SOH - 数据部分 - EOT`

  SOH： 标头开始符

  EOT：带结束



![封装](/Image/A4.链路层-photo/数据链路层_封装.png)



+ MTU：每一种数据链路层协议都规定了所能够传送的帧的数据部分长度的上限--即最大传输单元MTU（Maximum Transfer Unit），**以太网的MTU为1500个字节**。

### 2. 透明传输

透明表示一个实际存在的事物看起来好像不存在一样。


![透明传输](/Image/A4.链路层-photo/数据链路层_透明传输_1.png)

 帧的开始符为`SOH (start of head)`，是`ASCII`字符表中的，对应的16进制是0x01，结束符为`EOT (End of Transmission)`,也是`ASCII`字符表中。当传输二进制数据，很可能在数据部分出现和结束符相同的编码，那么为了避免提前结束，被错误的判定。那么就需要用转义字符`ECS`，来告诉接收端的数据链路层，这里不是真正的结束符号。其他需要转义的字符也是也是如此。在接收端进行处理之后可以还原出原始数据。这个过程透明传输的内容是转义字符，用户察觉不到转义字符的存在。

![透明传输](/Image/A4.链路层-photo/数据链路层_透明传输_2.png)





### 3. 差错检测

目前数据链路层广泛使用了循环冗余检验（CRC）来检查比特差错。
![透明传输](/Image/A4.链路层-photo/数据链路层_差错控制.png)
为了保证数据传输的可靠性，在计算机网络传输数据时，必须采用一些差错检测措施。目前比较广泛的是`CRC`。这部分位于数据帧的尾部:`FCS`部分。`FCS`是`CRC`的余数。如果无差错结束，这部分在接收端的数据链路层的数据帧中自动去掉。



#### 检测差错

- 奇偶校验
- 校验和
- 循环冗余校验

## 数据访问过程

一个数据包需要两个地址：

+ ip地址：告诉路由器去往哪里
+ 物理地址(mac)：确定的是要去往ip地址，下一跳应该去哪。因此是不断修改的。
+ 数据包：目的ip源ip+源端口和目的端口+数据
+ 数据帧：数据包+目标mac和源mac以及差错校验



## 信道分类

### 1. 广播信道

一对多通信，一个节点发送的数据能够被广播信道上所有的节点接收到。

所有的节点都在同一个广播信道上发送数据，因此需要有专门的控制方法进行协调，避免发生冲突（冲突也叫碰撞）。

主要有两种控制方法进行协调，一个是使用信道复用技术，一是使用 CSMA/CD 协议。

广播通信：

- 硬件地址（物理地址、MAC 地址）
- 单播（unicast）帧（一对一）：收到的帧的 MAC 地址与本站的硬件地址相同
- 广播（broadcast）帧（一对全体）：发送给本局域网上所有站点的帧
- 多播（multicast）帧（一对多）：发送给本局域网上一部分站点的帧

### 2. 点对点信道

一对一通信。

数据单元：帧

因为不会发生碰撞，因此也比较简单，使用 PPP 协议进行控制。

## 信道复用技术

### 1. 频分复用

频分复用的所有主机在相同的时间占用不同的频率带宽资源。

![img](/Image/A4.链路层-photo/680403129a371fb7_img24-1623741071018)

频分复用:4051

### 2. 时分复用

时分复用的所有主机在不同的时间占用相同的频率带宽资源。

![img](/Image/A4.链路层-photo/680403129a371fb7_img25-1623741071018)



使用频分复用和时分复用进行通信，在通信的过程中主机会一直占用一部分信道资源。但是由于计算机数据的突发性质，通信过程没必要一直占用信道资源而不让出给其它用户使用，因此这两种方式对信道的利用率都不高。

### 3. 统计时分复用

是对时分复用的一种改进，不固定每个用户在时分复用帧中的位置，只要有数据就集中起来组成统计时分复用帧然后发送。

 [![img](/Image/A4.链路层-photo/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f36323833626532612d383134612d346131302d383462662d3935393235333366653662632e706e67)](https://camo.githubusercontent.com/93bb1a834d92cdf7015182fbd04062dc59fc2d451c34334bd226b7429e00d9f5/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f36323833626532612d383134612d346131302d383462662d3935393235333366653662632e706e67) 

### 4. 波分复用

光的频分复用。由于光的频率很高，因此习惯上用波长而不是频率来表示所使用的光载波。

### 5. 码分复用

为每个用户分配 m bit 的码片，并且所有的码片正交，对于任意两个码片 [![img](https://camo.githubusercontent.com/cb19d7914e289404e5bd587c0aaec7d424c2d324e71496250e468043272e9a08/68747470733a2f2f6c617465782e636f6465636f67732e636f6d2f6769662e6c617465783f5c7665637b537d)](https://camo.githubusercontent.com/cb19d7914e289404e5bd587c0aaec7d424c2d324e71496250e468043272e9a08/68747470733a2f2f6c617465782e636f6465636f67732e636f6d2f6769662e6c617465783f5c7665637b537d) 和 [![img](https://camo.githubusercontent.com/6bb6f35a4d875ec06aaac352bc3d40e053dad7629c060df62cfd75d0fdd5499a/68747470733a2f2f6c617465782e636f6465636f67732e636f6d2f6769662e6c617465783f5c7665637b547d)](https://camo.githubusercontent.com/6bb6f35a4d875ec06aaac352bc3d40e053dad7629c060df62cfd75d0fdd5499a/68747470733a2f2f6c617465782e636f6465636f67732e636f6d2f6769662e6c617465783f5c7665637b547d) 有

 [![img](/Image/A4.链路层-photo/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f33303861303265392d333334362d343235312d386334312d6264353533366461623439312e706e67)](https://camo.githubusercontent.com/8b08ea3e94cc2d91bf6b52fc37521822bbc4700ed634ce3528280afcd33ebe0a/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f33303861303265392d333334362d343235312d386334312d6264353533366461623439312e706e67) 



为了讨论方便，取 m=8，设码片 [![img](https://camo.githubusercontent.com/cb19d7914e289404e5bd587c0aaec7d424c2d324e71496250e468043272e9a08/68747470733a2f2f6c617465782e636f6465636f67732e636f6d2f6769662e6c617465783f5c7665637b537d)](https://camo.githubusercontent.com/cb19d7914e289404e5bd587c0aaec7d424c2d324e71496250e468043272e9a08/68747470733a2f2f6c617465782e636f6465636f67732e636f6d2f6769662e6c617465783f5c7665637b537d) 为 00011011。在拥有该码片的用户发送比特 1 时就发送该码片，发送比特 0 时就发送该码片的反码 11100100。

在计算时将 00011011 记作 (-1 -1 -1 +1 +1 -1 +1 +1)，可以得到

 [![img](/Image/A4.链路层-photo/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f36666461316463372d356337342d343963312d626237392d3233376137376534336134332e706e67)](https://camo.githubusercontent.com/20bfc9ae0eb159cbc40db2c489d61b29cddd25f2feadbb9e01942ab480e2714f/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f36666461316463372d356337342d343963312d626237392d3233376137376534336134332e706e67) 



 [![img](/Image/A4.链路层-photo/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f65333235613930332d663062312d346662642d383262662d3838393133646332663239302e706e67)](https://camo.githubusercontent.com/e4073a0b2729615fb14e7cbfbfc3a21640ef0242823584675bba639efcb4d165/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f65333235613930332d663062312d346662642d383262662d3838393133646332663239302e706e67) 



其中 [![img](https://camo.githubusercontent.com/a7954229c9a5a18fd7973cf9ef50a1d518ba7c7b75ab6ff67c1947533ee918be/68747470733a2f2f6c617465782e636f6465636f67732e636f6d2f6769662e6c617465783f5c7665637b53277d)](https://camo.githubusercontent.com/a7954229c9a5a18fd7973cf9ef50a1d518ba7c7b75ab6ff67c1947533ee918be/68747470733a2f2f6c617465782e636f6465636f67732e636f6d2f6769662e6c617465783f5c7665637b53277d) 为 [![img](https://camo.githubusercontent.com/cb19d7914e289404e5bd587c0aaec7d424c2d324e71496250e468043272e9a08/68747470733a2f2f6c617465782e636f6465636f67732e636f6d2f6769662e6c617465783f5c7665637b537d)](https://camo.githubusercontent.com/cb19d7914e289404e5bd587c0aaec7d424c2d324e71496250e468043272e9a08/68747470733a2f2f6c617465782e636f6465636f67732e636f6d2f6769662e6c617465783f5c7665637b537d) 的反码。

利用上面的式子我们知道，当接收端使用码片 [![img](https://camo.githubusercontent.com/cb19d7914e289404e5bd587c0aaec7d424c2d324e71496250e468043272e9a08/68747470733a2f2f6c617465782e636f6465636f67732e636f6d2f6769662e6c617465783f5c7665637b537d)](https://camo.githubusercontent.com/cb19d7914e289404e5bd587c0aaec7d424c2d324e71496250e468043272e9a08/68747470733a2f2f6c617465782e636f6465636f67732e636f6d2f6769662e6c617465783f5c7665637b537d) 对接收到的数据进行内积运算时，结果为 0 的是其它用户发送的数据，结果为 1 的是用户发送的比特 1，结果为 -1 的是用户发送的比特 0。

码分复用需要发送的数据量为原先的 m 倍。

 [![img](/Image/A4.链路层-photo/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f39396236303630652d303939642d343230312d386538362d6638616233373638613763662e706e67)](https://camo.githubusercontent.com/624c6f658c33a6f14a7dde4854eee74190f30896d08c24684501ab448355aed0/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f39396236303630652d303939642d343230312d386538362d6638616233373638613763662e706e67) 

### 链路层协议集

- 给每个人一个讲话的机会
- 该你讲话时你才说话
- 不要一个人独占整个谈话
- 如果有问题请举手
- 当有人讲话时不要打断
- 当其他人讲话时不要睡觉



## CSMA/CD 协议

CSMA/CD 表示载波监听多点接入 / 碰撞检测。

- **多点接入**  ：说明这是总线型网络，许多主机以多点的方式连接到总线上。
- **载波监听**  ：每个主机都必须不停地监听信道。在发送前，如果监听到信道正在使用，就必须等待。**(说话之前先听)**
- **碰撞检测**  ：在发送中，如果监听到信道已有其它主机正在发送数据，就表示发生了碰撞。虽然每个主机在发送数据之前都已经监听到信道为空闲，但是由于电磁波的传播时延的存在，还是有可能会发生碰撞。 **（如果与他人同时开始说话，停止说话）**

记端到端的传播时延为 τ，最先发送的站点最多经过 2τ 就可以知道是否发生了碰撞，称 2τ 为   **争用期**  。只有经过争用期之后还没有检测到碰撞，才能肯定这次发送不会发生碰撞。

当发生碰撞时，站点要停止发送，等待一段时间再发送。这个时间采用   **截断二进制指数退避算法**   来确定。从离散的整数集合 {0, 1, .., (2k-1)} 中随机取出一个数，记作 r，然后取 r 倍的争用期作为重传等待时间。

 [![img](/Image/A4.链路层-photo/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f31396434323365392d373466372d346332622d396239372d3535383930653064353139332e706e67)](https://camo.githubusercontent.com/c9ed7f8c261248c3b519410c1f92a7c760a4fea9c2fac02165f7b33acc6b6259/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f31396434323365392d373466372d346332622d396239372d3535383930653064353139332e706e67) 



## PPP 协议

点对点协议（Point-to-Point Protocol）：互联网用户通常需要连接到某个 ISP 之后才能接入到互联网，PPP 协议是用户计算机和 ISP 进行通信时所使用的数据链路层协议。

 [![img](/Image/A4.链路层-photo/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f65316162396632382d636231352d343137382d383462322d3938616164383766396263382e6a7067)](https://camo.githubusercontent.com/3d9abfb0d155de05ad9de00f28324b7556bfb8d71a090757eda8f36cb714446f/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f65316162396632382d636231352d343137382d383462322d3938616164383766396263382e6a7067) 



PPP 的帧格式：

- F 字段为帧的定界符
- A 和 C 字段暂时没有意义
- FCS 字段是使用 CRC 的检验序列
- 信息部分的长度不超过 1500

 [![img](/Image/A4.链路层-photo/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f37353930313364372d363164382d343530392d383937612d6437356166353938613233362e706e67)](https://camo.githubusercontent.com/14699972272fda58894cd49c8a8935cd4918717367ccbda146f1956db044d86c/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f37353930313364372d363164382d343530392d383937612d6437356166353938613233362e706e67) MAC数据帧格式

![以太网MAC帧格式](/Image/A4.链路层-photo/数据链路层_以太网帧格式.png)

从网络层来的是 `IP 数据报`，数据链路层分别在添加上：目标MAC地址，源MAC地址，类型（ip数据报的类型），以及在结尾处添加了差错控制部分`fcs`。物理层在以太网的MAC数据帧上添加8字节数据。

当数据字段的长度小于46字节时，数据链路层就会在数据字段的后面加入一个整数字节的填充字段，以保证以太网的MAC帧长不小于64字节，接收端还必须能够将添加的字节去掉。

  ![不足64字节](/Image/A4.链路层-photo/数据链路层_以太网帧格式_数据长度不足64字节.png)

之所以是46个字节，是因为"目标MAC地址、源MAC地址以及类型分别占6,6,2个字节"，64-18=46。

+ 无效帧MAC帧

  + 帧的长度不是整数个字节。
  + 用收到的帧检验序列FCS查出有差错。
  + 收到帧的MAC客户的**数据字段的长度**不在**46-1500**字节之间。考虑到MAC帧首部和尾部的长度共有18字节，可以得出有效的MAC帧长度为64-1518字节之间。  

  **对于检查出的无效MAC帧就简单地丢弃， 以太网不负责重传丢弃的帧**。是否重传是上层应用层的任务，比如TCP会重新传输，而UDP不会重新传输。



## MAC 地址

MAC 地址是链路层地址，长度为 6 字节（48 位）：前24位是厂家 后面24位厂家自己指定。用于唯一标识网络适配器（网卡）。

一台主机拥有多少个网络适配器就有多少个 MAC 地址。例如笔记本电脑普遍存在无线网络适配器和有线网络适配器，因此就有两个 MAC 地址。

![img](/Image/A4.链路层-photo/fb2604a4106781a9_img5-1623741071019)

## MAC地址和IP地址

* MAC地址又叫硬件地址或物理地址，它不是地址位置，实际上是适配器地址，每一台计算机中固化在适配器的ROM中的地址，作用是用来定义网络设备的位置
* IP地址是IP协议提供的一种统一的地址格式，为互联网上的每一个网络和每一台主机分配一个逻辑地址，以此来屏蔽物理地址的差异
* 两者的区别
  * 物理地址是数据链路层和物理层使用的地址，放在MAC帧的首部
  * IP地址是网络层和以上各层使用的地址，放在IP数据报的首部

## 局域网

局域网是一种典型的广播信道，主要特点是网络为一个单位所拥有，且地理范围和站点数目均有限。

主要有以太网、令牌环网、FDDI 和 ATM 等局域网技术，目前以太网占领着有线局域网市场。

可以按照网络拓扑结构对局域网进行分类：

 [![img](/Image/A4.链路层-photo/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f38303766343235382d646261382d346335342d396333632d6137303763376363666661322e6a7067)](https://camo.githubusercontent.com/3dbb3aa31bd0eb11bffd36fdcb47bed553ef9ad9bac5b4a83c7cc3168c05a328/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f38303766343235382d646261382d346335342d396333632d6137303763376363666661322e6a7067) 

## 以太网

以太网是一种星型拓扑结构局域网组网技术。

早期使用集线器进行连接，集线器是一种物理层设备， 作用于比特而不是帧，当一个比特到达接口时，集线器重新生成这个比特，并将其能量强度放大，从而扩大网络的传输距离，之后再将这个比特发送到其它所有接口。如果集线器同时收到两个不同接口的帧，那么就发生了碰撞。

目前以太网使用交换机替代了集线器，交换机是一种链路层设备，它不会发生碰撞，能根据 MAC 地址进行存储转发。

以太网帧格式：

- **类型**  ：标记上层使用的协议；
- **数据**  ：长度在 46-1500 之间，如果太小则需要填充；
- **FCS**  ：帧检验序列，使用的是 CRC 检验方法；

 [![img](/Image/A4.链路层-photo/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f31363439343464332d626264322d346262322d393234622d6536323139396335316239302e706e67)](https://camo.githubusercontent.com/fcb8e6e98d8af8c07ae013fde39d37f21ff4bb292d1065dbc50fa7eeb0060f2c/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f31363439343464332d626264322d346262322d393234622d6536323139396335316239302e706e67)  ![img](/Image/A4.链路层-photo/437dc2ff98edb42a_img20-1623741071019)

### 以太网最短帧

为了能够检测到正在发送的帧在总线上是否产生冲突，以太网的帧不能太短，如果太短就有可能检测不到自己发送的帧产生了冲突。经过计算最短的帧是`64`字节

> 这就意味着**以太网发送数据帧如果前64字节没有检测出冲突，后面发送的数据就一定不会发生冲突**。换句话说，如果发生碰撞，就一定在发送前64字节之内。由于一旦检测出冲突就立即终止发送，这时发送的数据一定小于64字节，因此凡是长度小于64字节的帧都是由于冲突而异常终止的无效帧，只要收到了这种无效帧，就应当立即将其终止。



## 交换机

交换机具有自学习能力，学习的是交换表的内容，交换表中存储着 MAC 地址到接口的映射。

正是由于这种自学习能力，因此交换机是一种即插即用设备，不需要网络管理员手动配置交换表内容。

下图中，交换机有 4 个接口，主机 A 向主机 B 发送数据帧时，交换机把主机 A 到接口 1 的映射写入交换表中。为了发送数据帧到  B，先查交换表，此时没有主机 B 的表项，那么主机 A 就发送广播帧，主机 C 和主机 D 会丢弃该帧，主机 B 回应该帧向主机 A  发送数据包时，交换机查找交换表得到主机 A 映射的接口为 1，就发送数据帧到接口 1，同时交换机添加主机 B 到接口 2 的映射。

 [![img](/Image/A4.链路层-photo/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f61343434343534352d306436382d343031352d396133642d3139323039646334333662332e706e67)](https://camo.githubusercontent.com/4608d0909fc1073933ad910d422d38a1aebc48d650f324182e2496d2cf757205/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f61343434343534352d306436382d343031352d396133642d3139323039646334333662332e706e67) 

![image-20210614183318984](/Image/A4.链路层-photo/image-20210614183318984-1623741071019-1633579831247.png)

## 虚拟局域网

虚拟局域网可以建立与物理位置无关的逻辑组，只有在同一个虚拟局域网中的成员才会收到链路层广播信息。

例如下图中 (A1, A2, A3, A4) 属于一个虚拟局域网，A1 发送的广播会被 A2、A3、A4 收到，而其它站点收不到。

使用 VLAN 干线连接来建立虚拟局域网，每台交换机上的一个特殊接口被设置为干线接口，以互连 VLAN 交换机。IEEE 定义了一种扩展的以太网帧格式 802.1Q，它在标准以太网帧上加进了 4 字节首部 VLAN 标签，用于表示该帧属于哪一个虚拟局域网。

 [![img](/Image/A4.链路层-photo/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f65393865396432302d323036622d343533332d626163662d3334343864303039366633382e706e67)](https://camo.githubusercontent.com/56983a4d00d059a8c0c8889611d24e5a09a27db92f48692ed402862d21eb5f5b/68747470733a2f2f63732d6e6f7465732d313235363130393739362e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f65393865396432302d323036622d343533332d626163662d3334343864303039366633382e706e67) 





### 以太网和IEEE 802封装

以太网是当今TCP/IP采用的主要的局域网技术。它采用一种称作CSMA/CD的媒体接入方法，其意思是带冲突检测的载波侦听多路接入（Carrier Sense, Multiple Access with Collision Detection）。它的速率为 10 Mb/s，地址为48 bit 。

| 802.3 | CSMA/CD网络  |
| ----- | ------------ |
| 802.4 | 令牌总线网络 |
| 802.5 | 令牌环网络   |

![img](/Image/A4.链路层-photo/2021-08-08_15-58-55.png)

| 名称     | 帧大小           | 封装                     | RFC      |
| -------- | ---------------- | ------------------------ | -------- |
| 以太网帧 | 至少有 $46$ 字节 | 以太网 IP数据报          | RFC 894  |
| 802帧    | 至少为 $38$ 字节 | IEEE 802 网络的 IP数据报 | RFC 1042 |

两种帧格式都采用48bit（6字节）的目的地址和源地址。在802标准定义的帧格式中，长度字段是指它后续数据的字节长度，但不包括 CRC检验码。以太网的类型字段定义了后续数据的类型。

802定义的有效长度值与以太网的有效类型值无一相同，这样，就可以对两种帧格式进行区分。

帧大小不足时插入填充（$pad$）字节



### SLIP：串行线路IP

SLIP的全称是Serial Line IP 。它是一种在串行线路上对IP数据报进行封装的简单形式。

下面的规则描述了SLIP协议定义的帧格式：

1. IP数据报以一个称作END（0xc0）的特殊字符结束。为了防止数据报到来之前的线路噪声被当成数据报内容，大多数实现在数据报的开始处也传一个END字符。
2. 如果IP报文中某个字符为END，那么就要连续传输两个字节0xdb和0xdc来取代它。
3. 如果IP报文中某个字符为SLIP的ESC字符，那么就要连续传输两个字节0xdb和0xdd来取代它。

[![graphic](/Image/A4.链路层-photo/img2.png)](https://github.com/lutzchuck/tcpip-note/blob/master/img/chap2/img2.png)

SLIP的缺陷：

1. 每一端必须知道对方的IP地址。没有办法把本端的IP地址通知给另一端。
2. 数据帧中没有类型字段（类似于以太网中的类型字段）。如果一条串行线路用于SLIP，那么它不能同时使用其他协议。
3. SLIP没有在数据帧中加上检验和，只能通过上层协议来实现。

由于串行线路的速率较低，且通信常是交互式的，因此在SLIP线路上有许多小的TCP分组进行交换，这就带来了性能的缺陷。CSLIP是压缩的SLIP，它能把40个字节压缩到3-5个字节。

### PPP：点对点协议

PPP，点对点协议修改了SLIP协议中的所有缺陷。 PPP包括以下三个部分：

1. 在串行链路上封装IP数据报的方法。PPP既支持数据为 8位和无奇偶检验的异步模式，还支持面向比特的同步链接。
2. 建立、配置及测试数据链路的链路控制协议（LCP：LinkControl Protocol ）。它允许通信双方进行协商，以确定不同的选项。
3. 针对不同网络层协议的网络控制协议（NCP）体系

每一帧都以标志字符0x7e开始和结束。紧接着是一个地址字节，值始终是0xff，然后是一个值为0x03的控制字节。

[![graphic](/Image/A4.链路层-photo/img3.png)](https://github.com/lutzchuck/tcpip-note/blob/master/img/chap2/img3.png)

由于标志字符的值是0x7e，因此当该字符出现在信息字段中时， PPP需要对它进行转义。在同步链路中，该过程是通过一种称作比特填充 (bit stuffing)的硬件技术来完成的。

PPP比SLIP 具有下面这些优点： 

1. PPP支持在单根串行线路上运行多种协议不只是IP协议；
2. 每一帧都有循环冗余检验；
3. 通信双方可以进行IP地址的动态协商（使用IP网络控制协议）
4. 与CSLIP类似，对TCP和IP报文首部进行压缩；
5. 链路控制协议可以对多个数据链路选项进行设置。为这些优点付出的代价是在每一帧的首部增加3个字节，当建立链路时要发送几帧协商数据，以及史为复杂的实现。

### 



### 环回接口

大多数的产品都支持环回接口（Loopback Interface），以允许运行在同一台主机上的客户程序和服务器程序通过TCP/IP进行通信。

A 类网络号127就是为环回接口预留的。根据惯例，大多数系统把 IP地址127.0.0.1 分配给这个接口，并命名为localhost。一个传给环回接口的IP数据报不能在任何网络上出现。

一旦传输层检测到目的端地址是环回地址时，应该可以省略部分传输层和所有网络层的逻辑操作。但是大多数的产品还是照样完成传输层和网络层的所有过程，只是当IP数据报离开网络层时把它返回给自己。

需要指出的关键点：

1) 传给环回地址（一般是 $1 2 7 . 0 . 0 . 1$ ）的任何数据均作为IP 输入。
2) 传给广播地址或多播地址的数据报复制一份传给环回接口然后送到以太网上。这是因为广播传送和多播传送的定义包含主机本身。
3)  任何传给该主机I P地址的数据均送到环回接口。

### 最大传输单元MTU

太网和 $802.3$ 对数据帧的长度都有一个限制，其最大值分别是$1500$ 和 $1492$ 字节。链路层的这个物理特性称作 MTU ，最大传输单元。

如果IP 层有一个数据报要传，而且数据的长度比链路层的 MTU还大，那么IP 层就需要进行分片（ fragmentation），把数据报分成若干片，这样每一片都小于MTU。

### 路径MTU

两台通信主机路径中的最小 MTU​ 。它被称作路径 MTU。
两台主机之间的路径 MTU 取决于当时所选择的路由。而选路不一定是对称的（从A到B的路由可能与从B到A的路由不同），因此路径 MTU 在两个方向上不一定是一致的。

#### 串行线路吞吐量计算

有关与人的研究表明，交互响应时间超过 $1 0 0～200 ms$ 就被认为是不好的

## 
